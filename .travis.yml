language: erlang
arch: 
  - ppc64le
  - amd64

os: linux

dist: bionic

before_install:
  - pip install --user cpp-coveralls coveralls-merge
  - if [ "$TRAVIS_ARCH" = "ppc64le" ]; then sudo apt-get update; sudo apt-get install rebar; fi

install:
  - sudo apt-get -q install libgd-dev libwebp-dev libpng-dev libjpeg-dev
  - ./configure --enable-gcov

script: make && make xref && make test

after_success:
  - cpp-coveralls --exclude lib --exclude tests --gcov-options '\-lp' --dump c.json
  - coveralls-merge c.json erlang.json

otp_release:
  - 22.0
  - 22.3
  - 23.0
